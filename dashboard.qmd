---
title: "Rain Garden Decision Support Tool"
subtitle:  "Urban Futures Hackathon: Hadrosaur Footprints"
format: html
execute:
  warning: false
  message: false
---

## Interactive Map
```{python}
#| echo: false
import requests
import pandas as pd
import numpy as np
from plotnine import *
import folium
import matplotlib as plt
from sodapy import Socrata
%matplotlib inline

#min_lon, max_lon = 45, 30
#min_lat, max_lat = -80, -70
m = folium.Map(location=(40.75736962, -73.83414849),
  control_scale=True, zoom_start=11
  #max_bounds=True,
  #zoom_start=6,
  #min_lat=min_lat,
  #max_lat=max_lat,
  #min_lon=min_lon,
  #max_lon=max_lon
)       

#folium.CircleMarker([max_lat, min_lon], tooltip="Upper Left Corner").add_to(m)
#folium.CircleMarker([min_lat, min_lon], tooltip="Lower Left Corner").add_to(m)
#folium.CircleMarker([min_lat, max_lon], tooltip="Lower Right Corner").add_to(m)
#folium.CircleMarker([max_lat, max_lon], tooltip="Upper Right Corner").add_to(m)   

MyAppToken= 'qydv1FJZD87b8NQb4kxMP8TUE'
client = Socrata("data.cityofnewyork.us", MyAppToken,
username='ga1193@nyu.edu',
password='PWT*jbq*pjk*aur9tyk'
)
rain_garden = client.get("df32-vzax", content_type="geojson",
where="asset_type='Rain Garden'")

bus_shelters = client.get("t4f2-8md7", content_type="geojson",
where="boro_name = 'Queens'")

litter_baskets = client.get("8znf-7b2c", content_type="geojson")


#geo_json_data = requests.get(
#     'https://data.cityofnewyork.us/resource/df32-vzax.geojson'
#).json()

```
``` {python}
#| echo: false

# Adding pedestrian data to map
import pandas as pd
import geopandas as gpd
pedestrian_data = pd.read_csv('C:/Users/gastudillo.SONOMATECH/OneDrive - spherosenvironmental.com/Documents/GitHub/Urban-Futures-a-NYC_Hackathon/data/Pedestrian_Data.csv')
ped_data = pedestrian_data.loc[:, ("the_geom", "Longitude", "Latitude", "OBJECTID", "Loc", "Borough","Street_Nam","From_Stree","To_Street","Iex", "Last 5 Year Average")]
#ped_data.info()

y = ped_data.Latitude.str.strip("'")
x = ped_data.Longitude.str.strip("'")
#shp_map1 = gpd.read_file(('C:/Users/gastudillo.SONOMATECH/OneDrive - spherosenvironmental.com/Documents/GitHub/Urban-Futures-a-NYC_Hackathon/data/school_locations/SchoolPoints_APS_2024_08_28'))

geometry = gpd.points_from_xy(x,y)
geo_df = gpd.GeoDataFrame(
    ped_data, geometry=geometry
)

geo_df.head()

geo_df_list = [[point.xy[1][0], point.xy[0][0]] for point in geo_df.geometry]

```

```{python}
#| echo: false
import geopandas as gpd
community_orgs = pd.read_excel('C:/Users/gastudillo.SONOMATECH/OneDrive - spherosenvironmental.com/Documents/GitHub/Urban-Futures-a-NYC_Hackathon/data/community_orgs.xlsx')
geometry = gpd.points_from_xy(community_orgs.Lat,community_orgs.Lon)
geo_df_co = gpd.GeoDataFrame(
    community_orgs, geometry=geometry
)

geo_df_co.head()

geo_df_co_list = [[point.xy[1][0], point.xy[0][0]] for point in geo_df.geometry]


```

```{python}
#| echo: false

# Read in DEP data from api
import requests

fg_rg = folium.FeatureGroup(name="Rain Gardens", control=True,show=False).add_to(m)
fg_bs = folium.FeatureGroup(name="Bus Shelters", control=True,show=False).add_to(m)
fg_lb = folium.FeatureGroup(name="Litter Basket", control=True,show=False).add_to(m)
fg_pd = folium.FeatureGroup(name="Pedestrian Data", control=True,show=False).add_to(m)
fg_co = folium.FeatureGroup(name="Community Orgs", control=True,show=False).add_to(m)




folium.GeoJson(rain_garden,overlay=True, zoom_on_click=True,
marker=folium.Marker(icon=folium.Icon(icon='star')),
style_function=lambda x: {
        'markerColor': 'blue'},
        popup=folium.GeoJsonPopup(fields=["gi_id", "constructed_date","status"])).add_to(fg_rg)
folium.GeoJson(bus_shelters,overlay=True,
marker=folium.Marker(icon=folium.Icon(icon='star')),
style_function=lambda x: {
        'markerColor': 'purple'}).add_to(fg_bs)
folium.GeoJson(litter_baskets,overlay=True,
marker=folium.Marker(icon=folium.Icon(icon='star')),
style_function=lambda x: {
        'markerColor': 'yellow'}).add_to(fg_lb)


folium.LayerControl().add_to(m)
#folium.Marker([40.75736962, -73.83414849], popup=html).add_to(m)
#folium.GeoJson(rain_garden).add_to(m)
#folium.GeoJson(bus_shelters).add_to(m)

i = 0
for coordinates in geo_df_list:
# Place the markers with the popup labels and data
        type_color = "purple",
        fg_pd.add_child(
                
                folium.Marker(
                location=coordinates,
                icon=folium.Icon(color="%s" % type_color),
                popup="5 Year Avg Foot Traffic: " + str(geo_df['Last 5 Year Average'][i])
                )
        
        )
        i = i + 1

j = 0
for coordinates in geo_df_co_list:
# Place the markers with the popup labels and data
        type_color = "yellow",
        fg_co.add_child(
                
                folium.Marker(
                location=coordinates,
                icon=folium.Icon(color="%s" % type_color),
                popup="Local Org: " + str(geo_df_co['Org'][j])
                )
        
        )
        j = j


m

```


## Model Results



**Top 15 Sites to Maintain**
```{python}
#| echo: false

file_path = "rain_garden_maintenance_priority.ods"
df = pd.read_excel(file_path, engine="odf")


# Center map
center_lat = df["lat"].mean()
center_lon = df["lon"].mean()

#m = folium.Map(location=[center_lat, center_lon], zoom_start=12, tiles="OpenStreetMap")

for _, r in df.iterrows():
    prio = int(r["priority"])
    color = "green" if 1 <= prio <= 5 else "orange"
    
    popup = folium.Popup(f"Priority: {prio}", max_width=250)
    
    # Pin-like marker (FontAwesome)
    folium.Marker(
        location=[r["lat"], r["lon"]],
        popup=popup,
        icon=folium.Icon(color=color, icon="map-marker", prefix="fa"),
    ).add_to(m)
m
```

**Model Output**: 

{{< embed LEAP_Hackathon-2.ipynb#model-fxn echo=false >}}